<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="utf-8" />
    <title>Dynamic Form (Vanilla JS)</title>
    <style>
      body {
        font-family: sans-serif;
        margin: 24px;
      }
      .row {
        display: flex;
        gap: 8px;
        align-items: center;
        margin-bottom: 8px;
      }
      .row input {
        flex: 1;
        padding: 6px 8px;
      }
      .row button {
        padding: 6px 10px;
      }
      .actions {
        margin-top: 16px;
        display: flex;
        gap: 8px;
      }
      .note {
        color: #666;
        font-size: 12px;
        margin-top: 6px;
      }
      .output {
        margin-top: 16px;
        background: #f6f6f6;
        padding: 12px;
        border-radius: 6px;
      }
    </style>
  </head>
  <body>
    <h2>ฟอร์มเพิ่ม/ลบช่อง และส่งเป็น Array</h2>

    <form id="dynamicForm" action="/your-endpoint" method="POST">
      <div id="list">
        <!-- เริ่มต้นมี 1 ช่อง -->
        <div class="row">
          <input name="items[]" type="text" placeholder="ใส่ค่า..." />
          <button type="button" class="remove" aria-label="ลบแถว">ลบ</button>
        </div>
      </div>

      <div class="actions">
        <button type="button" id="add">+ เพิ่มแถว</button>
        <button type="submit">ส่งฟอร์ม</button>
      </div>

      <div class="note">
        หมายเหตุ: ฟิลด์ใช้ชื่อ
        <code>items[]</code> เพื่อให้ฝั่งเซิร์ฟเวอร์รับเป็นอาร์เรย์อัตโนมัติ
      </div>
    </form>

    <div class="output" id="preview" hidden></div>

    <!-- เทมเพลตของแถวใหม่ -->
    <template id="row-template">
      <div class="row">
        <input name="items[]" type="text" placeholder="ใส่ค่า..." />
        <button type="button" class="remove" aria-label="ลบแถว">ลบ</button>
      </div>
    </template>

    <script>
      const list = document.getElementById("list");
      const addBtn = document.getElementById("add");
      const form = document.getElementById("dynamicForm");
      const tmpl = document.getElementById("row-template");
      const preview = document.getElementById("preview");

      // เพิ่มแถวใหม่
      addBtn.addEventListener("click", () => {
        const node = tmpl.content.firstElementChild.cloneNode(true);
        list.appendChild(node);
      });

      // ลบแถว (ใช้ event delegation)
      list.addEventListener("click", (e) => {
        if (e.target.classList.contains("remove")) {
          const row = e.target.closest(".row");
          // กันไว้ไม่ให้ลบจนไม่เหลือช่องเลย
          if (list.children.length > 1) row.remove();
        }
      });

      // ส่งฟอร์ม (เดโม: ป้องกันส่งจริง แล้วแปลงค่าเป็น array มาแสดงผล)
      form.addEventListener("submit", (e) => {
        e.preventDefault();

        // เก็บเป็น array ด้วย FormData
        const fd = new FormData(form);
        const items = fd
          .getAll("items[]")
          .map((v) => v.trim())
          .filter((v) => v !== "");

        // แสดงผลให้ดู
        preview.hidden = false;
        preview.textContent = "Array ที่ได้: " + JSON.stringify(items, null, 2);
        console.log("items array =>", items);

        // ถ้าจะส่งจริงไปเซิร์ฟเวอร์ ให้เอา e.preventDefault() ออก
        // หรือใช้ fetch:
        // fetch(form.action, { method: 'POST', body: fd });
      });
    </script>
  </body>
</html>
